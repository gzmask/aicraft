var AICRAFT=AICRAFT||{};"undefined"!==typeof exports&&null!==exports&&(exports.AICRAFT=AICRAFT);AICRAFT.Engine=function(){this.dynamicsWorld=this.everyone=void 0;this.totalPlayers=2;this.players=[];this.ais=[]};
AICRAFT.Engine._makeJson=function(a){var c='({"bindings":[';a.forEach(function(a){c+='{"position":';c+="["+a.position.x+","+a.position.y+","+a.position.z+"],";c+='"quaternion":';c+="["+a.quaternion.x+","+a.quaternion.y+","+a.quaternion.z+","+a.quaternion.w+"],";c+='"velocity":';c+="["+a.phybody.getAngularVelocity().getX()+","+a.phybody.getAngularVelocity().getY()+","+a.phybody.getAngularVelocity().getZ()+"]";c+="},"});c+="]})";return eval(c)};
AICRAFT.Engine.prototype={constructor:AICRAFT.Engine,init:function(a,c,b){var d=new b.btDefaultCollisionConfiguration,f=new b.btCollisionDispatcher(d),e=new b.btDbvtBroadphase,i=new b.btSequentialImpulseConstraintSolver;this.dynamicsWorld=new b.btDiscreteDynamicsWorld(f,e,i,d);this.dynamicsWorld.setGravity(new b.btVector3(0,-9.82,0));this.dynamicsWorld.trans=new b.btTransform;this.dynamicsWorld.trans.setIdentity();d=new b.btBoxShape(new b.btVector3(400,0.5,400));e=new b.btTransform;e.setIdentity();
e.setOrigin(new b.btVector3(0,-5.5,0));f=new b.btVector3(0,0,0);e=new b.btDefaultMotionState(e);d=new b.btRigidBodyConstructionInfo(0,e,d,f);this.dynamicsWorld.addRigidBody(new b.btRigidBody(d));var h=new b.btQuaternion,g=this;(function(){for(var a=0;a<g.totalPlayers;a++)h.setEuler(0,20,-30),g.players[a]=new AICRAFT.Player(-200+Math.floor(401*Math.random()),25,-200+Math.floor(301*Math.random()),h.getX(),h.getY(),h.getZ(),h.getW()),g.players[a].buildPhysic(b),g.dynamicsWorld.addRigidBody(g.players[a].phybody),
h.setEuler(0,20,30),g.ais[a]=new AICRAFT.Ai(g.players[a].position.x,5,g.players[a].position.z-5,h.getX(),h.getY(),h.getZ(),h.getW()),g.ais[a].buildPhysic(b),g.dynamicsWorld.addRigidBody(g.ais[a].phybody)})();this.everyone=c.initialize(a);this.everyone.now.logStuff=function(a){console.log(a);console.log(this.now.a)};this.everyone.now.totalPlayers=this.totalPlayers;this.everyone.now.players=AICRAFT.Engine._makeJson(this.players);this.everyone.now.ais=AICRAFT.Engine._makeJson(this.ais)},animate:function(){var a=
this;AICRAFT.requestAnimationFrame(function(){a.animate()});this.dynamicsWorld.stepSimulation(1/30,10);this.players.forEach(function(a){a.physicUpdate(this.dynamicsWorld)},this);this.ais.forEach(function(a){a.physicUpdate(this.dynamicsWorld)},this)}};AICRAFT.GameObject=function(a,c,b,d,f,e,i){this.position={};this.position.x=a;this.position.y=c;this.position.z=b;this.quaternion={};this.quaternion.x=d||0;this.quaternion.y=f||0;this.quaternion.z=e||0;this.quaternion.w=void 0===i?1:i;this.phybody=this.mesh=void 0;this.width=8;this.height=1;this.depth=8;this.radius=5;this.mass=1};
AICRAFT.GameObject.prototype={constructor:AICRAFT.GameObject,buildMesh:function(a){this.mesh=new a.Mesh(new a.CubeGeometry(this.width,this.height,this.depth),new a.MeshLambertMaterial({color:16777215}));this.mesh.castShadow=!0;this.mesh.receiveShadow=!0;this.mesh.position.x=this.position.x;this.mesh.position.y=this.position.y;this.mesh.position.z=this.position.z;this.mesh.useQuaternion=!0;this.mesh.quaternion.set(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)},buildPhysic:function(a){var c=
new a.btBoxShape(new a.btVector3(this.width/2,this.height/2,this.depth/2)),b=new a.btTransform;b.setIdentity();b.setOrigin(new a.btVector3(this.position.x,this.position.y,this.position.z));b.setRotation(new a.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w));var d=0!=this.mass,f=new a.btVector3(0,0,0);d&&c.calculateLocalInertia(this.mass,f);b=new a.btDefaultMotionState(b);c=new a.btRigidBodyConstructionInfo(this.mass,b,c,f);this.phybody=new a.btRigidBody(c);this.phybody.setFriction(3)},
physicAndGraphicUpdate:function(a){this.phybody.getMotionState()&&(this.phybody.getMotionState().getWorldTransform(a.trans),this.position.x=this.mesh.position.x=a.trans.getOrigin().x().toFixed(2),this.position.y=this.mesh.position.y=a.trans.getOrigin().y().toFixed(2),this.position.z=this.mesh.position.z=a.trans.getOrigin().z().toFixed(2),this.quaternion.x=this.mesh.quaternion.x=a.trans.getRotation().x(),this.quaternion.y=this.mesh.quaternion.y=a.trans.getRotation().y(),this.quaternion.z=this.mesh.quaternion.z=
a.trans.getRotation().z(),this.quaternion.w=this.mesh.quaternion.w=a.trans.getRotation().w())},physicUpdate:function(a){this.phybody.getMotionState()&&(this.phybody.getMotionState().getWorldTransform(a.trans),this.position.x=a.trans.getOrigin().x().toFixed(2),this.position.y=a.trans.getOrigin().y().toFixed(2),this.position.z=a.trans.getOrigin().z().toFixed(2),this.quaternion.x=a.trans.getRotation().x(),this.quaternion.y=a.trans.getRotation().y(),this.quaternion.z=a.trans.getRotation().z(),this.quaternion.w=
a.trans.getRotation().w())}};AICRAFT.Ai=function(a,c,b,d,f,e,i){AICRAFT.GameObject.call(this,a,c,b,d,f,e,i)};AICRAFT.Ai.prototype=new AICRAFT.GameObject;AICRAFT.Ai.prototype.constructor=AICRAFT.Ai;AICRAFT.Player=function(a,c,b,d,f,e,i){this.maxSpeed=20;this.acceleration=4;this.connected=!1;AICRAFT.GameObject.call(this,a,c,b,d,f,e,i)};AICRAFT.Player.prototype=new AICRAFT.GameObject;AICRAFT.Player.prototype.constructor=AICRAFT.Player;AICRAFT.requestAnimationFrame=function(a){return setTimeout(a,1E3/60)};
